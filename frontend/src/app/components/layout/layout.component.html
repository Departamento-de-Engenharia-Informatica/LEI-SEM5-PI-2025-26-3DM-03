  <!-- Application root: render app when logged-in; when logged-out allow a public viewer route; otherwise show login -->
<ng-container *ngIf="auth.loggedIn$ | async; else unauthArea">
<div   class="app-shell"> 
  <header class="app-header" role="banner">
    <div class="header-left">
      <!-- Sidebar toggle (three dots) -->
      <button class="sidebar-toggle" aria-label="Toggle menu" title="Toggle menu" (click)="toggleSidebar()">
        <span class="hamburger" [class.open]="sidebarExpanded">
          <span></span><span></span><span></span>
        </span>
      </button>
      <div class="logo" aria-hidden="true">
        <!-- simple svg logo -->
        <svg width="36" height="36" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect width="24" height="24" rx="4" fill="#02284A"></rect>
          <path d="M6 15L10 9L14 15" stroke="#0EA5A4" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
      </div>
      <div class="title">{{ title }}</div>
    </div>

    <div class="header-right">
      <div class="lang-switch">
        <button class="lang-btn" (click)="changeLang('en')" [class.active]="lang==='en'">EN</button>
        <button class="lang-btn" (click)="changeLang('pt')" [class.active]="lang==='pt'">PT</button>
      </div>
      <div class="user-area">
  <img class="avatar" [src]="avatarUrl" alt="avatar" aria-hidden="true" (click)="openAvatarModal()" />
        <div class="account-info">
          <div class="account-name">{{ auth.user?.name || auth.user?.email }}</div>
          <div class="role">{{ (auth.user?.role || '-') | uppercase }}</div>
        </div>
        <button class="btn-ghost" (click)="logout()">{{ i18n.t('logout') }}</button>
      </div>
    </div>
  </header>

  <div class="app-body">
    <!-- Global toasts -->
    <app-toast-container></app-toast-container>
    <!-- Invisible left-edge hotspot: hover here to temporarily open the sidebar -->
    <div class="left-hotspot" (mouseenter)="openHotspot()" (mouseleave)="closeHotspot()" (click)="toggleSidebar()" aria-hidden="true"></div>
  <aside class="sidebar" role="navigation" [class.collapsed]="!sidebarExpanded" [class.closed]="sidebarCollapsed && !hotspotOpen">
      <nav>
        <ul>
      <li *ngFor="let item of displayedMenu" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }"
              class="menu-parent" [class.has-submenu]="item.key === 'vessels'">

            <!-- Item principal -->
        <a class="menu-item"
          [routerLink]="item.key !== 'vessels' ? item.route : null"
          (click)="onMenuClick(item, $event)"
          [attr.data-key]="item.key"
          role="button">
              
              <span class="icon" aria-hidden="true">
                <ng-container *ngIf="item.icon === 'svg-ship'; else biIcon">
                  <svg class="inline-icon" viewBox="0 0 24 24" width="16" height="16"
                      fill="none" stroke="currentColor" stroke-width="1.5"
                      stroke-linecap="round" stroke-linejoin="round"
                      focusable="false" aria-hidden="true">
                    <path d="M12 4v7" />
                    <path d="M5 13h14l-1.5 4H6.5L5 13z" />
                    <path d="M4 17l2 3h12l2-3" />
                  </svg>
                </ng-container>
                <ng-template #biIcon>
                  <i class="bi" [ngClass]="item.icon"></i>
                </ng-template>
              </span>

              <span class="label">{{ label(item) }}</span>

              <i *ngIf="item.key === 'vessels'" class="bi bi-caret-down-fill submenu-caret"
                [class.rotate]="activeSubmenu === item.key"></i>
            </a>

            <!-- Submenu: sÃ³ aparece ao passar o rato -->
            <ul *ngIf="item.key === 'vessels' && activeSubmenu === item.key" class="submenu visible">
              <li><a routerLink="/vessels" class="submenu-item">Vessels</a></li>
              <li><a routerLink="/vessel-types" class="submenu-item">Vessel Types</a></li>
              <li><a routerLink="/vessel-visit-notifications" class="submenu-item">Visit Notifications</a></li>
            </ul>
          </li>
        </ul>
      </nav>

      <div class="sidebar-footer">
        <small class="muted">{{ lang==='pt' ? 'Ajuda' : 'Help' }}</small>
      </div>
    </aside>

    <main class="main-content" role="main"> 
      <div class="breadcrumbs" aria-hidden="true">{{ i18n.t('home') }} / <span class="muted">{{ i18n.t('breadcrumb.dashboard') }}</span></div>
      <router-outlet></router-outlet>
      <footer class="app-footer"></footer>
    </main>
  </div>
</div>

<!-- Avatar modal overlay -->
<div class="avatar-modal" *ngIf="avatarModalOpen" (click)="closeAvatarModal()" tabindex="-1" aria-modal="true" role="dialog">
  <div class="avatar-modal-content" (click)="$event.stopPropagation()">
    <button class="close-btn" (click)="closeAvatarModal()" aria-label="Close">&times;</button>
    <img [src]="avatarUrl" alt="profile image large" />
  </div>
</div>

 </ng-container>

<ng-template #unauthArea>
  <ng-container *ngIf="isViewerRoute; else publicArea">
    <!-- Public 3D viewer route -->
    <router-outlet></router-outlet>
  </ng-container>
</ng-template>

<ng-template #publicArea>
  <app-login></app-login>
</ng-template>




 
