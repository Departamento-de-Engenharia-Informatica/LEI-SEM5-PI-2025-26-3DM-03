<div class="page modern">
  <!-- Header / toolbar -->
  <header class="page-header">
    <div class="breadcrumbs">Home / Docks</div>

    <div class="header-main">
      <div class="title-block">
        <h1 class="page-title">Docks</h1>
        <p class="page-subtitle">
          Gest√£o das docas do porto ‚Äî ver, criar e editar.
        </p>
      </div>

      <div class="header-controls">
        <!-- Search -->
        <div class="search-field">
          <span class="search-icon">üîç</span>
          <input
            type="search"
            placeholder="Pesquisar por nome ou localiza√ß√£o..."
            [(ngModel)]="q"
            (ngModelChange)="applyFilterSort()"
          />
          <button
            *ngIf="q"
            class="chip-btn clear-btn"
            type="button"
            (click)="q=''; applyFilterSort();"
            aria-label="Limpar pesquisa"
          >
            ‚úï
          </button>
        </div>

        <!-- Sort -->
        <div class="sort-field">
          <label class="sort-label">Ordenar por</label>
          <div class="sort-input">
            <select
              [(ngModel)]="sortKey"
              (change)="applyFilterSort()"
            >
              <option value="name">Nome</option>
              <option value="location">Localiza√ß√£o</option>
              <option value="length">Comprimento</option>
              <option value="depth">Profundidade</option>
              <option value="maxDraft">Max Draft</option>
            </select>

            <button
              type="button"
              class="icon-toggle"
              (click)="changeSort(sortKey)"
              [attr.aria-label]="sortDir === 'asc' ? 'Ordenar descendente' : 'Ordenar ascendente'"
            >
              <span>{{ sortDir === 'asc' ? '‚ñ≤' : '‚ñº' }}</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Estado de loading / erro -->
  <section class="status-row" *ngIf="loading || error">
    <div *ngIf="loading" class="status-pill muted">
      A carregar docas...
    </div>
    <div *ngIf="error" class="status-pill error">
      {{ error }}
    </div>
  </section>

  <section class="summary-grid" *ngIf="summaryMetrics.length">
    <article
      class="summary-card"
      *ngFor="let metric of summaryMetrics"
      [class.summary-card--highlight]="metric.highlight"
    >
      <div class="summary-icon" aria-hidden="true">{{ metric.icon }}</div>
      <div class="summary-info">
        <span class="summary-label">{{ metric.label }}</span>
        <span class="summary-value">{{ metric.value }}</span>
        <span class="summary-hint">{{ metric.hint }}</span>
      </div>
    </article>
  </section>

  <!-- Layout principal -->
  <div class="layout">
    <!-- Formul√°rio lateral -->
    <aside class="side">
      <section class="card form-card">
        <header class="card-header">
          <h2 class="card-title">Criar nova doca</h2>
          <p class="card-subtitle">
            Define as caracter√≠sticas principais da doca. Podes editar mais tarde.
          </p>
        </header>

        <form
          class="form"
          (ngSubmit)="createDock()"
        >
          <div class="form-caption">Preenche os campos e cria a doca instantaneamente.</div>

          <label>
            <span>Nome</span>
            <input
              [(ngModel)]="newDock.name"
              name="name"
              required
            />
          </label>

            <label>
              <span>Localiza√ß√£o</span>
              <input
                [(ngModel)]="newDock.location"
                name="location"
              />
            </label>
          <label>
            <span>Localiza√ß√£o</span>
            <input
              [(ngModel)]="newDock.location"
              name="location"
            />
          </label>

          <div class="row">
            <label>
              <span>Comprimento (m)</span>
              <input
                type="number"
                [(ngModel)]="newDock.length"
                name="length"
              />
            </label>
            <label>
              <span>Profundidade (m)</span>
              <input
                type="number"
                [(ngModel)]="newDock.depth"
                name="depth"
              />
            </label>
            <label>
              <span>Max Draft (m)</span>
              <input
                type="number"
                [(ngModel)]="newDock.maxDraft"
                name="maxDraft"
              />
            </label>
          </div>

          <button
            class="btn primary full"
            type="submit"
          >
            Criar dock
          </button>
        </form>
      </section>
    </aside>

    <!-- Lista de docks -->
    <main class="content">
      <section class="cards" *ngIf="filtered.length; else emptyState">
        <article
          class="dock-card"
          *ngFor="let dock of filtered"
        >
          <div class="card-head">
            <div class="meta">
              <div class="name-line">
                <span class="name">{{ dock.name }}</span>
                <span class="tag" *ngIf="dock.location; else locationFallback">{{ dock.location }}</span>
              </div>
              <ng-template #locationFallback>
                <span class="tag muted">Sem localiza√ß√£o</span>
              </ng-template>
            </div>
            <div class="actions">
              <button
                class="icon-btn"
                type="button"
                title="Editar"
                (click)="openEdit(dock)"
              >
                ‚úé
              </button>
              <button
                class="icon-btn danger"
                type="button"
                title="Eliminar"
                (click)="deleteDock(dock.id)"
              >
                üóë
              </button>
            </div>
          </div>

          <div class="card-body">
            <div class="stat">
              <div class="label">Comprimento</div>
              <div class="value">
                <span class="number">
                  {{
                    dock.length !== null && dock.length !== undefined
                      ? dock.length
                      : '-'
                  }}
                </span>
                <span
                  class="unit"
                  *ngIf="dock.length !== null && dock.length !== undefined"
                >
                  m
                </span>
              </div>
            </div>

            <div class="stat">
              <div class="label">Profundidade</div>
              <div class="value">
                <span class="number">
                  {{
                    dock.depth !== null && dock.depth !== undefined
                      ? dock.depth
                      : '-'
                  }}
                </span>
                <span
                  class="unit"
                  *ngIf="dock.depth !== null && dock.depth !== undefined"
                >
                  m
                </span>
              </div>
            </div>

            <div class="stat">
              <div class="label">Max Draft</div>
              <div class="value">
                <span class="number">
                  {{
                    dock.maxDraft !== null && dock.maxDraft !== undefined
                      ? dock.maxDraft
                      : '-'
                  }}
                </span>
                <span
                  class="unit"
                  *ngIf="dock.maxDraft !== null && dock.maxDraft !== undefined"
                >
                  m
                </span>
              </div>
            </div>
          </div>
        </article>
      </section>

      <ng-template #emptyState>
        <div class="empty-state">
          <div class="emoji">‚öì</div>
          <div class="text-title">Sem docas encontradas</div>
          <div class="text-sub">
            Cria a primeira doca √† esquerda ou ajusta os filtros de pesquisa.
          </div>
        </div>
      </ng-template>
    </main>
  </div>

  <!-- Modal de edi√ß√£o -->
  <div
    class="modal-backdrop"
    *ngIf="editing"
  >
    <div class="modal">
      <header class="modal-header">
        <div>
          <h2>Editar doca</h2>
          <p>Atualiza os dados desta doca.</p>
        </div>
        <button
          type="button"
          class="icon-btn"
          (click)="closeEdit()"
          aria-label="Fechar"
        >
          ‚úï
        </button>
      </header>

      <form
        class="form"
        (ngSubmit)="saveEdit()"
      >
        <label>
          <span>Nome</span>
          <input
            [(ngModel)]="editing!.name"
            name="edit_name"
            required
          />
        </label>

        <label>
          <span>Localiza√ß√£o</span>
          <input
            [(ngModel)]="editing!.location"
            name="edit_location"
          />
        </label>

  <div class="row metrics-row">
  <div class="metric-field">
    <span class="metric-label">Comprimento</span>
    <div class="metric-input">
      <input
        type="number"
        [(ngModel)]="editing!.length"
        name="edit_length"
      />
      <span class="unit">m</span>
    </div>
  </div>

  <div class="metric-field">
    <span class="metric-label">Profundidade</span>
    <div class="metric-input">
      <input
        type="number"
        [(ngModel)]="editing!.depth"
        name="edit_depth"
      />
      <span class="unit">m</span>
    </div>
  </div>

  <div class="metric-field">
    <span class="metric-label">Max Draft</span>
    <div class="metric-input">
      <input
        type="number"
        [(ngModel)]="editing!.maxDraft"
        name="edit_maxDraft"
      />
      <span class="unit">m</span>
    </div>
  </div>
</div>


        <div class="modal-actions">
          <div *ngIf="error" class="status-pill error small" role="alert">
            {{ error }}
          </div>

          <button
            class="btn"
            type="button"
            (click)="closeEdit()"
            [disabled]="saving"
          >
            Cancelar
          </button>
          <button
            class="btn primary"
            type="submit"
            [disabled]="saving"
          >
            {{ saving ? 'A guardar...' : 'Guardar altera√ß√µes' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
