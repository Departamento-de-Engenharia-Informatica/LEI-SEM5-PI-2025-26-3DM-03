<div class="vessels-container page resources-like">
  <div class="page-header">
    <div>
  <h2 class="page-title">Vessels</h2>
  <p class="muted subtitle">Manage vessels registered in the system</p>
    </div>
    <div class="header-actions">
      <!-- optional actions can go here (kept empty to keep title left-aligned) -->
    </div>
  </div>

  <!-- Success message -->
  <div *ngIf="successMessage" class="success-box">{{ successMessage }}</div>

  <!-- Toolbar -->
  <div class="toolbar">
    <input
      type="text"
      placeholder="Search by name or IMO..."
      [(ngModel)]="searchTerm"
      (ngModelChange)="onSearchChange($event)"
      class="search-input"
    />
    <button class="btn-secondary" (click)="clearSearch()">Clear</button>
    <button class="btn-primary" (click)="newVessel()">+ New Vessel</button>
  </div>

  <!-- Loading state -->
  <div *ngIf="loading && !showForm" class="loading">A carregar...</div>

  <!-- Vessel list (only shows when NOT editing/creating) -->
  <ul class="vessel-list" *ngIf="!showForm && !loading">
    <li *ngFor="let vessel of filteredVessels()" class="vessel-item">
      <div class="vessel-info">
        <strong class="vessel-name">{{ vessel.name }}</strong>
        <span *ngIf="vessel.imo" class="vessel-imo">IMO: {{ vessel.imo }}</span>
      </div>
      <button class="edit-btn" (click)="editVessel(vessel)">Edit</button>
    </li>

    <li *ngIf="!loading && filteredVessels().length === 0" class="empty">
      No vessels found.
    </li>
  </ul>

  <!-- Vessel form (only shows when showForm = true) -->
  <div *ngIf="showForm" class="vessel-form card">
    <h3>{{ isEditing ? 'Edit Vessel' : 'Create Vessel' }}</h3>

    <form (ngSubmit)="save()" autocomplete="off">
      <div class="form-group">
        <label for="vesselName">Name</label>
        <input
          id="vesselName"
          type="text"
          [(ngModel)]="currentVessel.name"
          name="name"
          required
        />
      </div>

      <div class="form-group">
        <div class="label-row">
          <label for="vesselImo">IMO</label>
          <button
            type="button"
            class="info-badge"
            (click)="toggleImoHelp()"
            aria-label="Como preencher o IMO">
            !
          </button>
        </div>
        <input
          id="vesselImo"
          type="text"
          [(ngModel)]="currentVessel.imo"
          name="imo"
          required
          maxlength="7"
          pattern="^[0-9]{7}$"
          [disabled]="isEditing"
        />
        <small class="hint">Must contain exactly 7 digits (no spaces or letters)</small>
        <div *ngIf="showImoHelp" class="info-box">
          IMO uses 7 digits plus a check digit: (d1*7 + d2*6 + d3*5 + d4*4 + d5*3 + d6*2) % 10 = d7.
          Example: 342354<b>0</b>.
        </div>
      </div>

      <div class="form-group select-group">
        <label for="vesselType">Vessel Type</label>
        <select
          id="vesselType"
          class="custom-select"
          [(ngModel)]="currentVessel.vesselTypeId"
          name="vesselTypeId"
          required
        >
          <option value="" disabled selected>Select vessel type</option>
          <option *ngFor="let t of vesselTypes" [ngValue]="t.id">
            {{ t.name }}
          </option>
        </select>
      </div>

      <div class="form-group">
        <label for="operator">Operator</label>
        <input
          id="operator"
          type="text"
          [(ngModel)]="currentVessel.operator"
          name="operator"
          placeholder="Optional"
        />
      </div>

      <div class="form-actions">
        <button class="btn-primary" type="submit">Save</button>
        <button class="btn-secondary" type="button" (click)="cancel()">Cancel</button>
      </div>
    </form>

    <div *ngIf="formError" class="error-box">{{ formError }}</div>
  </div>
</div>
