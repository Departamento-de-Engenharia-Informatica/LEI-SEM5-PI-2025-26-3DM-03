<div class="page reps">
  <!-- HEADER -->
  <div class="page-header">
    <div>
      <h2>{{ 'reps.title' | translate }}</h2>
      <p class="muted">{{ 'reps.subtitle' | translate }}</p>
    </div>

    <div class="header-actions">
      <div class="agent-input">
        <label>{{ 'reps.agent.tax' | translate }}</label>
        <input type="number"
               [(ngModel)]="taxNumber"
               [placeholder]="('reps.agent.example' | translate)" />
      </div>
      <button class="btn-primary" (click)="load()">
        <i class="bi bi-arrow-repeat"></i> {{ 'reps.load' | translate }}
      </button>
    </div>
  </div>

  <!-- ALERTAS -->
  <div *ngIf="error" class="alert alert-error">{{ error }}</div>
  <div *ngIf="loading" class="loading">A carregarâ€¦</div>
  <div *ngIf="!loading && !error && filtered.length === 0" class="alert">
    {{ 'reps.noData' | translate }}
  </div>

  <!-- SEARCH BAR -->
  <div class="toolbar" *ngIf="!loading">
    <div class="search">
      <i class="bi bi-search"></i>
      <input type="text"
             [(ngModel)]="q"
             (ngModelChange)="applyFilterSort()"
             [placeholder]="('reps.search' | translate)" />
    </div>
  </div>

  <!-- TABLE -->
  <div class="card" *ngIf="!loading">
    <table class="tbl">
      <thead>
        <tr>
          <th (click)="changeSort('name')">{{ 'reps.table.name' | translate }}</th>
          <th (click)="changeSort('citizenID')">{{ 'reps.table.citizen' | translate }}</th>
          <th (click)="changeSort('nationality')">{{ 'reps.table.nationality' | translate }}</th>
          <th (click)="changeSort('email')">{{ 'reps.table.email' | translate }}</th>
          <th (click)="changeSort('phoneNumber')">{{ 'reps.table.phone' | translate }}</th>
          <th (click)="changeSort('isActive')">{{ 'reps.table.status' | translate }}</th>
          <th>{{ 'reps.table.actions' | translate }}</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let r of filtered">
          <td>{{ r.name }}</td>
          <td>{{ r.citizenID }}</td>
          <td>{{ r.nationality }}</td>
          <td>{{ r.email }}</td>
          <td>{{ r.phoneNumber }}</td>
          <td>
            <span class="badge"
                  [class.badge-green]="r.isActive"
                  [class.badge-gray]="!r.isActive">
              {{ (r.isActive ? 'reps.status.active' : 'reps.status.inactive') | translate }}
            </span>
          </td>
          <td class="actions">
            <button class="btn-ghost" (click)="openEdit(r)">
              <i class="bi bi-pencil"></i>
            </button>
            <button class="btn-ghost"
                    (click)="deactivate(r)"
                    [disabled]="!r.isActive">
              <i class="bi bi-slash-circle"></i>
            </button>
            <button class="btn-ghost danger"
                    (click)="remove(r)">
              <i class="bi bi-trash"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- CREATE + EDIT GRID -->
  <div class="grid">
    <!-- NEW REPRESENTATIVE -->
    <section class="card">
      <h3>{{ 'reps.new.title' | translate }}</h3>

      <!-- NEW: EDITABLE TAX NUMBER INSIDE THE CARD -->
      <div class="form-grid" style="margin-bottom: 0.75rem;">
        <label>
          {{ 'reps.agent.tax' | translate }}
          <input type="number"
                 [(ngModel)]="taxNumber"
                 [placeholder]="('reps.agent.example' | translate)" />
        </label>
      </div>

      <!-- FORM FIELDS -->
      <div class="form-grid">
        <label>
          {{ 'reps.table.name' | translate }}
          <input [(ngModel)]="newRep.name"
                 [placeholder]="('reps.new.name' | translate)" />
        </label>

        <label>
          {{ 'reps.table.citizen' | translate }}
          <input [(ngModel)]="newRep.citizenID"
                 [placeholder]="('reps.new.citizen' | translate)" />
        </label>

        <label>
          {{ 'reps.table.nationality' | translate }}
          <input [(ngModel)]="newRep.nationality"
                 [placeholder]="('reps.new.nationality' | translate)" />
        </label>

        <label>
          {{ 'reps.table.email' | translate }}
          <input type="email"
                 [(ngModel)]="newRep.email"
                 [placeholder]="('reps.new.email' | translate)" />
        </label>

        <label>
          {{ 'reps.table.phone' | translate }}
          <input [(ngModel)]="newRep.phoneNumber"
                 [placeholder]="('reps.new.phone' | translate)" />
        </label>
      </div>

      <!-- BUTTON -->
      <div>
        <button type="button"
                class="btn-primary"
                (click)="create()"
                [disabled]="!taxNumber">
          {{ 'reps.new.create' | translate }}
        </button>
      </div>
    </section>

    <!-- EDIT REPRESENTATIVE -->
    <section class="card" *ngIf="editing">
      <h3>{{ 'reps.edit.title' | translate }}</h3>

      <div class="form-grid">
        <label>{{ 'reps.table.name' | translate }}
          <input [(ngModel)]="editing.name" />
        </label>

        <label>{{ 'reps.table.citizen' | translate }}
          <input [(ngModel)]="editing.citizenID" />
        </label>

        <label>{{ 'reps.table.nationality' | translate }}
          <input [(ngModel)]="editing.nationality" />
        </label>

        <label>{{ 'reps.table.email' | translate }}
          <input type="email" [(ngModel)]="editing.email" />
        </label>

        <label>{{ 'reps.table.phone' | translate }}
          <input [(ngModel)]="editing.phoneNumber" />
        </label>

        <label>{{ 'reps.table.status' | translate }}
          <select [(ngModel)]="editing.isActive">
            <option [ngValue]="true">{{ 'reps.status.active' | translate }}</option>
            <option [ngValue]="false">{{ 'reps.status.inactive' | translate }}</option>
          </select>
        </label>
      </div>

      <div class="actions">
        <button type="button" class="btn-primary" (click)="saveEdit()">
          {{ 'reps.edit.save' | translate }}
        </button>
        <button type="button" class="btn-ghost" (click)="closeEdit()">
          {{ 'reps.edit.cancel' | translate }}
        </button>
      </div>
    </section>
  </div>
</div>
