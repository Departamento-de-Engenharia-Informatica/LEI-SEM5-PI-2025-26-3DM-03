@startuml C2_Manage_Representatives_SSD
title C2 — System Sequence Diagram (Vista de Processos) — Manage Representatives
autonumber
hide footbox

actor "Port Authority Officer" as Officer
participant "Frontend Web App" as Frontend
participant "Representatives Management API" as API
participant "RepresentativeService" as Service
participant "RepresentativeMapper" as Mapper
participant "IShippingAgentRepository" as Repo
participant "PortContext (EF Core)" as Context
database "PLMS Database" as DB

== Create Representative ==
Officer -> Frontend : Fill and submit form (CreateRepresentativeDTO)
Frontend -> API : POST /api/shipping-agents/{taxNumber}/representatives
API -> Service : CreateRepresentative(dto)
Service -> Repo : Check if organization exists (taxNumber)
Repo -> Context : SELECT ShippingAgent
Context -> DB : Query by TaxNumber
DB --> Context : Result
Context --> Repo : Organization found
Service -> Mapper : ToDomain(dto)
Mapper --> Service : Representative (domain)
Service -> Repo : AddRepresentative(ShippingAgent, Representative)
Repo -> Context : INSERT Representative
Context -> DB : Save Representative
DB --> Context : OK
Context --> Repo : OK
Repo --> Service : OK
Service -> Mapper : ToDTO(Representative)
Mapper --> Service : RepresentativeDTO
Service --> API : RepresentativeDTO
API --> Frontend : 201 Created (RepresentativeDTO)
Frontend --> Officer : Confirmation shown

== Update Representative ==
Officer -> Frontend : Update form fields
Frontend -> API : PUT /api/shipping-agents/{taxNumber}/representatives/{id}
API -> Service : UpdateRepresentative(dto)
Service -> Repo : GetRepresentative(id)
Repo -> Context : SELECT Representative
Context -> DB : Load data
DB --> Context : OK
Context --> Repo : Representative found
Service -> Mapper : Apply updates
Mapper --> Service : Updated Representative
Service -> Repo : SaveChangesAsync()
Repo -> Context : UPDATE Representative
Context -> DB : Save
DB --> Context : OK
Service --> API : Updated RepresentativeDTO
API --> Frontend : 200 OK

== Deactivate Representative ==
Officer -> Frontend : Deactivate request
Frontend -> API : POST /api/shipping-agents/{taxNumber}/representatives/{id}/deactivate
API -> Service : DeactivateRepresentative(id)
Service -> Repo : GetRepresentative(id)
Repo -> Context : SELECT Representative
Context -> DB : Load data
DB --> Context : Representative found
Service -> Repo : Set IsActive = false
Repo -> Context : UPDATE Representative
Context -> DB : Save
DB --> Context : OK
Service --> API : 204 No Content
API --> Frontend : Confirmation message
Frontend --> Officer : Representative deactivated

@enduml
