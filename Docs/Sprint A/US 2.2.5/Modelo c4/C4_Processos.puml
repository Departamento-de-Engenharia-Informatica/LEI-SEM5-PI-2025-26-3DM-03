@startuml C4_Register_Shipping_Agents_Process_View
title C4 – Register Shipping Agents (Process View – Create Organization)
hide footbox
autonumber

actor "Organization Representative" as Rep
participant "Frontend Web App\n(React / Angular)" as Frontend
participant "Shipping Agents Management API\n(ASP.NET Core)" as API
participant "ShippingAgentService\n(Application Logic)" as Service
participant "ShippingAgentMapper\n(DTO ↔ Domain)" as Mapper
participant "IShippingAgentRepository\n(Domain Port)" as Repo
participant "EfShippingAgentRepository\n(Infra Adapter)" as RepoImpl
participant "PortContext\n(Entity Framework Core)" as Context
database "PLMS Database\n(SQL / EF Core)" as DB

== Authentication ==
Rep -> Frontend : Sign in (credentials)
Frontend -> API : Authorization: Bearer <JWT>

== Submit Organization ==
Rep -> Frontend : Fill & submit form
note right of Frontend
  Fields: TaxNumber, LegalName, AlternativeName,
  Address, Representatives[≥1], Type
end note
Frontend -> API : POST /api/shipping-agents (JSON)

== Validation & Mapping ==
API -> Service : RegisterAsync(dto)
Service -> Service : Validate required fields
Service -> Mapper : ToDomain(dto)
Mapper --> Service : ShippingAgent

== Persistence ==
Service -> Repo : AddAsync(ShippingAgent)
Repo -> RepoImpl : delegate
RepoImpl -> Context : AddAsync(entity)
RepoImpl -> Context : SaveChangesAsync()
Context -> DB : INSERT ShippingAgent + Representatives
DB --> Context : OK
Context --> RepoImpl : OK
RepoImpl --> Repo : OK
Repo --> Service : OK

== Response ==
Service -> Mapper : ToDTO(ShippingAgent)
Mapper --> Service : ShippingAgentDTO
Service --> API : ShippingAgentDTO
API --> Frontend : 201 Created (ShippingAgentDTO)
Frontend --> Rep : Show confirmation
@enduml
