@startuml C3_ShippingAgentsAPI_Logical_Components
!include <C4/C4_Component>

title C3 — Componentes (Vista Lógica) — Shipping Agents Management API

' ==== Contexto externo mínimo ====
Container(web, "Frontend Web App", "React/Angular", "UI para registo e revisão")
ContainerDb(db, "PLMS Database", "SQL / EF Core", "Dados de Shipping Agents")

' ==== Container em foco ====
Container_Boundary(api, "Shipping Agents Management API (ASP.NET Core)") {
  Component(controller, "ShippingAgentsController", "ASP.NET Core MVC", "Endpoints REST: criar, obter por TaxNumber")
  Component(service, "ShippingAgentService", "Application Layer", "Orquestra lógica de negócio do registo")
  Component(mapper, "ShippingAgentMapper", "Mapping", "DTO ↔ Domain")
  Component(repoIface, "IShippingAgentRepository", "Domain Port", "Contrato de acesso a dados")
  Component(repoImpl, "EfShippingAgentRepository", "Infrastructure Adapter (EF Core)", "Implementa o repositório")
  Component(validator, "ShippingAgentValidator", "Application/Domain", "Regras: TaxNumber único, campos obrigatórios, etc.")
}

' ==== Relações (fluxo principal) ====
Rel(web, controller, "HTTP/JSON")
Rel(controller, service, "chama")
Rel(service, validator, "valida")
Rel(service, mapper, "mapeia DTO→Domain/Domain→DTO")
Rel(service, repoIface, "usa (depende de)")
Rel(repoImpl, repoIface, "implementa", "C#")
Rel(repoImpl, db, "CRUD via EF Core", "SQL")

' opcional: dependência interna do impl para o ORM
Rel(repoImpl, mapper, "usa (opcional)")

@enduml
